<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Now Joining â€” Live Updates</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <style>
    :root {
      --primary-font: 'Orbitron', sans-serif;
      --secondary-font: 'Instrument Sans', sans-serif;
      --purple-dark: #B102CC;
      --purple-light: #CD41E3;
      --white: #FFFFFF;
    --yellow: #F2C202;   
    --Purple: #FF11CB; 
    --blue: #1956DA;
    --purple-light: #F83ACF;
    --black: #000000;
    --black-light: #1A1A1A;
    --orange: #F83A3A;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--primary-font);
      overflow-x: hidden;
      color: white;
    }

    /* Container */
.live-drop-container {
    padding: 10px 60px;
    height: 90vh;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: flex-start;
    background-image: url("Assets/Media/Images/drop\ bg.png");
    background-size: contain;
    background-repeat: no-repeat;
    background-position: top center;
}
    .live-drop-logo {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-bottom: 50px;
      width: 100%;
    }

    .live-drop-logo img {
      width: 120px;
    }

    .close-btn {
    background: linear-gradient(90deg, var(--blue), var(--purple-light));
    color: white;
    font-family: var(--secondary-font);
    padding: 0.9rem 2.8rem;
    border-radius: 50px;
    font-size: 1rem;
    cursor: pointer;
    }

    .live-drop-main {
      display: flex;
      gap: 30px;
      width: 100%;
    }

    /* LEFT CARD */
    .live-drop-card-left {
      background: linear-gradient(145deg, var(--purple-dark), var(--purple-light));
      border-radius: 20px;
      padding: 15px 20px;
      width: 50%;
      border: 4px solid hsl(0deg 0% 100% / 40%);
      
    }

    .live-drop-left-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .live-drop-card-left h2 {
      font-size: 40px;
      font-weight: 500;
      color: #fff;
      margin: 0 0 5px 0;
      font-family: var(--primary-font);
    }

    .left-head-left p {
      margin: 0;
      font-family: var(--secondary-font);
      padding-bottom: 20px;
    }

    .left-head-right {
      text-align: right;
    }

    .left-head-right p {
      font-family: var(--secondary-font);
      font-size: 14px;
      font-weight: 500;
      margin: 0;
    }

    /* Progress bar */
    .progress-container {
      width: 100%;
      background: #FF11CB;
      border-radius: 8px;
      height: 10px;
      margin: 10px 0;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: white;
      width: 0;
    }

    /* ===== JOIN LIST (Div version) ===== */
.join-list {
  margin-top: 10px;
  display: flex;
  flex-direction: column;
  width: 100%;
  border-radius: 10px;
  height: 360px;
  overflow-y: auto;
  overflow-x: hidden;
}

/* Scrollbar customization */
.join-list::-webkit-scrollbar {
  width: 5px;
}

.join-list::-webkit-scrollbar-track {
  background: #D467E4;
  border-radius: 10px;
  padding: 2px;
}

.join-list::-webkit-scrollbar-thumb {
  background: white;
  border-radius: 10px;
}

.join-list::-webkit-scrollbar-thumb:hover {
  background: white;
}

.join-list {
  scroll-behavior: smooth;
}


    /* Header Row */
.join-header {
    display: grid;
    grid-template-columns: 8% 25% 25% 25% 17%;
    background: rgb(255 255 255 / 21%);
    backdrop-filter: blur(4px);
    font-weight: 500;
    text-transform: uppercase;
    font-size: 15px;
    padding: 10px 8px;
    font-family: var(--primary-font);
    color: #ffffff;
    border-radius: 10px;
}

    /* Data Rows */
    .join-row {
      display: grid;
      grid-template-columns: 8% 25% 25% 25% 17%;
      padding: 10px 8px;
      font-size: 14px;
      font-family: var(--secondary-font);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 10px;
    }

    .join-row:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .join-cell {
      color: var(--white);
    }

    .join-cell.time {
      /* text-align: right; */
    }

    .step-btn {
    background: linear-gradient(90deg, var(--yellow), var(--orange));
    color: white;
    font-family: var(--secondary-font);
    padding: 0.9rem 2.5rem;
    border-radius: 50px;
    font-size: 1.1rem;
    line-height: 1.4rem;
    margin-top: 50px;
    cursor: pointer;
    }


    /* RIGHT CARD */
    .card-right {
      background: rgba(25, 25, 25, 0.9);
      border-radius: 20px;
      padding: 25px 30px;
      width: 50%;
      backdrop-filter: blur(15px);
    }

    .card-right h2 {
      font-size: 30px;
      font-weight: 600;
      color: #fff;
      margin: 0 0 15px 0;
    }

    .city {
    margin-bottom: 18px;
    border: 1px solid #ffffff5c;
    padding: 10px;
    border-radius: 10px;
    }

    .city-name {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .city-progress {
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      overflow: hidden;
    }

    .city-bar {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, #ff00ff, #ff007b);
    }
  </style>
</head>
<body style="background: black">
  <div class="live-drop-container">
    <div class="live-drop-logo">
      <img src="Assets/Media/Images/logo.png" alt="">
      <button class="close-btn" onclick="window.parent.closedropModal()">Close</button>
    </div>

    <div class="live-drop-main">
      <!-- LEFT PANEL -->
      <div class="live-drop-card-left">
        <div class="live-drop-left-head">
          <div class="left-head-left">
            <h2>Now Joining</h2>
            <p>Updates live</p>
          </div>
          <div class="left-head-right">
            <p>Founders locked in trailer: 85/100</p>
            <div class="progress-container">
              <div class="progress-bar" id="joinProgress"></div>
            </div>
          </div>
        </div>

        <!-- JOIN LIST -->
        <div class="join-header">
            <div>#</div>
            <div>Name</div>
            <div>World</div>
            <div>City</div>
            <div>Time</div>
          </div>
        <div class="join-list" id="joinList">


        </div>

    
      </div>

      <!-- RIGHT PANEL -->
      <div class="card-right" id="cityRace">
          <div class="left-head-left">
            <h2>City race</h2>
            <p>Glow = Leading</p>
          </div>
       
      </div>
    </div>
    <button class="step-btn" id="openFormBtn" onclick="window.parent.openFormModal()">Step In</button>
  </div>

  <!-- GSAP -->
  <script>
    window.addEventListener("load", () => {
      gsap.to("#joinProgress", {
        width: "85%",
        duration: 1.5,
        ease: "power2.out"
      });

      const maxValue = 100;
      document.querySelectorAll(".city-bar").forEach(bar => {
        const value = bar.dataset.value;
        const percent = (value / maxValue) * 100;
        gsap.to(bar, {
          width: percent + "%",
          duration: 1.2,
          ease: "power2.out",
          delay: 0.3
        });
      });
    });
  </script>
  <script>
  // Get the container
  const joinList = document.getElementById('joinList');

  // Fetch API data
  fetch('https://on10.io/arc/api/get_orders.php')
    .then(response => response.json())
    .then(data => {
      const orders = data.orders;

      // Loop through each order and create HTML rows
      orders.forEach((order, index) => {
        const row = document.createElement('div');
        row.className = 'join-row';

        // You can customize what you display here
        row.innerHTML = `
          <div class="join-cell">${index + 1}</div>
          <div class="join-cell">${order.username}</div>
          <div class="join-cell">${order.cards}</div>
          <div class="join-cell">${order.city}</div>
          <div class="join-cell time">${timeAgo(order.created_at)}</div>
        `;

        joinList.appendChild(row);
      });
    })
    .catch(error => console.error('Error fetching orders:', error));

  // Optional: function to display "Just Now", "X minutes ago", etc.
  function timeAgo(dateString) {
    const now = new Date();
    const past = new Date(dateString);
    const diff = Math.floor((now - past) / 1000); // seconds

    if (diff < 60) return 'Just Now';
    if (diff < 3600) return Math.floor(diff / 60) + ' min ago';
    if (diff < 86400) return Math.floor(diff / 3600) + ' hr ago';
    return Math.floor(diff / 86400) + ' days ago';
  }
</script>
<script>
const cityRaceContainer = document.getElementById('cityRace');

// Fetch API data
fetch('https://on10.io/arc/api/get_orders.php')
  .then(response => response.json())
  .then(data => {
    const regions = data.regions;

    regions.forEach(region => {
      // Create city container
      const cityDiv = document.createElement('div');
      cityDiv.className = 'city';

      const maxValue = 100;
const widthPercent = (region.order_count / maxValue) * 100;

      // Inner HTML for city name and count
      cityDiv.innerHTML = `
        <div class="city-name">
          <span>${region.city}</span>
          <span>${region.order_count}</span>
        </div>
        <div class="city-progress">
          <div class="city-bar" data-value="${region.order_count}" style="width: ${widthPercent}%"></div>
        </div>
      `;

      cityRaceContainer.appendChild(cityDiv);
    });
  })
  .catch(err => console.error('Error fetching city data:', err));
</script>
</body>
</html>
